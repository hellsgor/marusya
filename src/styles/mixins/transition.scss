@use '../custom/variables' as vars;
@use 'sass:list';
@use 'sass:string';
@use 'sass:meta';

/// - Если первый аргумент — число (например, 150ms), он берётся как duration
/// - Если второй аргумент — строка (например, ease-in-out), он берётся как timing-function
/// - Всё остальное считается списком свойств
///
/// Поддерживает вызовы:
///   @include transition(transform, opacity);                   // оба свойства, duration/func из vars
///   @include transition(150ms, transform, opacity);            // новая duration, func из vars
///   @include transition(150ms, ease-in-out, transform);        // новые duration+func, свойство
///   @include transition($duration:150ms, $props: transform);   // именованные аргументы

@mixin transition($args...) {
  $duration: vars.$transition-duration;
  $func: vars.$transition-func;
  $props: ();

  $n: list.length($args);

  @if $n == 0 {
    @warn "Не передано ни одного CSS-свойства в @include transition()";
  } @else if meta.type-of(list.nth($args, 1)) == 'number' {
    $duration: list.nth($args, 1);

    @if $n > 1 and meta.type-of(list.nth($args, 2)) == 'string' {
      $func: list.nth($args, 2);
      @for $i from 3 through $n {
        $props: list.append($props, list.nth($args, $i), comma);
      }
    } @else {
      @for $i from 2 through $n {
        $props: list.append($props, list.nth($args, $i), comma);
      }
    }
  } @else {
    @for $i from 1 through $n {
      $props: list.append($props, list.nth($args, $i), comma);
    }
  }

  $transitions: ();
  @each $prop in $props {
    $entry: string.unquote('#{$prop} #{$duration} #{$func}');
    $transitions: list.append($transitions, $entry, comma);
  }

  /* stylelint-disable */
  transition: $transitions;
  will-change: $props;
  /* stylelint-enable */
}
